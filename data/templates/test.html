{% load custom_filters %}
<!DOCTYPE html>
<html>
<head>
    <title>NIFTY Option Chain</title>
    
    <style>
        table { border-collapse: collapse; width: 98%; margin: 20px auto; font-size: 13px; }
        th, td { border: 1px solid #222; padding: 4px; text-align: center; }
        th { background: #f2f2f2; position: sticky; top: 0; }
        .positive { color: green; font-weight: bold; }
        .negative { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h2 style="text-align:center;">NIFTY Option Chain (Open Interest)</h2>
    <p style="text-align:center;">Current LTP: {{ ltp }}</p>

    <!-- First table -->
    <table>
        <tr>
            <th>CE OI Change</th>
            <th>CE Open Interest</th>
            <th>Strike Price</th>
            <th>PE Open Interest</th>
            <th>PE OI Change</th>
        </tr>
        {% for row in table %}
        <tr>
            <td>
                {% if row.ce_diff > 0 %}
                    <span class="positive">+{{ row.ce_diff }}</span>
                {% elif row.ce_diff < 0 %}
                    <span class="negative">{{ row.ce_diff }}</span>
                {% else %}{{ row.ce_diff }}{% endif %}
            </td>
            <td>{{ row.ce }}</td>
            <td>{{ row.strike }}</td>
            <td>{{ row.pe }}</td>
            <td>
                {% if row.pe_diff > 0 %}
                    <span class="positive">+{{ row.pe_diff }}</span>
                {% elif row.pe_diff < 0 %}
                    <span class="negative">{{ row.pe_diff }}</span>
                {% else %}{{ row.pe_diff }}{% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>

<h2 style="text-align:center;">Open Interest Difference (Last Hour)</h2>

<table border="1" style="border-collapse: collapse; width: 100%;">
    <thead>
        <tr>
            <th rowspan="2">Time</th>
            {% for strike in strikes %}
                <th colspan="2" style="text-align: center;">{{ strike }}</th>
            {% endfor %}
        </tr>
        <tr>
            {% for strike in strikes %}
                <th style="text-align: center;">CE</th>
                <th style="text-align: center;">PE</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for row in data %}
            <tr>
                <td style="text-align: center;">{{ row.time }}</td>
                {% for strike_data in row.strikes %}
                    <td style="text-align: center;">{{ strike_data.ce }}</td>
                    <td style="text-align: center;">{{ strike_data.pe }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </tbody>
</table>


</body>
</html>
